# Multi-Persona AI Chat

## 概要

このアプリケーションは、複数の個性豊かなAIペルソナ（キャラクター）と対話できる、GUIベースのチャットクライアントです。Googleの`gemini`コマンドラインツールをバックエンドとして利用し、PySide6を用いてグラフィカルなインターフェースを構築しています。

最大の特徴は、AIたちが単なる応答マシンではなく、**会話を通じて得た学びを「記憶」として蓄積**し、それに基づいて応答する点です。ユーザーはAIと対話するだけでなく、AI同士の自律的な会話（雑談や討論）を眺めたり、時にはAIから話しかけられたりすることもできます。

## ✨ 主な機能

*   **詳細なペルソナ設定**: `personas.json`で、各AIの基本情報に加えて、背景・価値観・癖・目標といった詳細な人格設定が可能です。
*   **永続的な学習・記憶システム**:
    *   各ペルソナが会話内容を**個別に学習**し、要約を`learning_history.json`に保存します。
    *   アプリケーションを再起動しても記憶が引き継がれ、ペルソナが「成長」していく体験を実現します。
    *   応答を生成する際、AIは自身の「記憶」を参照し、より深みのある発言を行います。
*   **高度な対話機能**:
    *   **指名応答**: メッセージにAIの名前（例：「湊くん、教えて」）を含めることで、特定のAIに応答させることができます。
    *   **全員への質問**: `/ask_all`コマンドを使うと、参加している全てのAIが順番に質問へ応答します。
    *   **AIからの話しかけ**: 自動会話中に、AIがユーザーに話を振ってくることがあります。
*   **シームレスなAI同士の会話**:
    *   **雑談モード**: ユーザーがしばらく入力しないと、AIたちが自律的に雑談を始めます。
    *   **討論モード**: サイドバーからテーマを設定すると、AIたちが司会者と参加者に分かれて本格的なディベートを行います。
        *   ユーザーが自由に議論に参加できます。
        *   「討論停止」ボタンで、司会者による**議論の総括**が行われ、綺麗に完結します。
        *   討論終了後、その流れを汲んで**自然に雑談（感想戦）に移行**します。
*   **豊富なコマンド機能**: 参加者の変更、セッションの保存・再開、ニックネーム設定など、`/help`で全コマンドを確認できます。
*   **安定した動作**:
    *   `gemini-2.5-flash`モデルを単一で使用し、安定した動作を実現します。
    *   会話履歴が長くなると、古い内容をAIが自動的に要約・圧縮します。

## ⚙️ 動作環境と必要なもの

*   Python 3.8 以上
*   PySide6
*   Node.js および npm
*   Google Gemini CLI (`gemini`)

## 🛠️ インストールとセットアップ

1.  **Pythonライブラリのインストール**:
    ターミナルまたはコマンドプロンプトで、以下のコマンドを実行してPySide6をインストールします。
    ```bash
    pip install PySide6
    ```

2.  **Google Gemini CLIのインストール**:
    `gemini`コマンドラインツールをグローバルにインストールします。
    ```bash
    npm install -g @google/gemini-cli
    ```

3.  **Gemini CLIの認証**:
    インストール後、以下のコマンドを実行してGoogleアカウントで認証を行ってください。ブラウザが開き、認証プロセスを進めることができます。
    ```bash
    gemini auth
    ```

4.  **ファイル構成**:
    アプリケーションを実行するには、以下のファイルが同じディレクトリに配置されている必要があります。
    ```
    .
    ├── main.py                   # アプリケーションの起動スクリプト
    ├── ui.py                     # UIとメインロジック
    ├── debate.py                 # AI同士の自動会話ロジック
    ├── config_session_command.py # コマンドと設定管理
    ├── persona.py                # ペルソナクラスの定義
    ├── learning_manager.py       # ペルソナの学習履歴を管理
    ├── personas.json             # AIペルソナの定義ファイル
    │
    ├── config.json               # (自動生成) ユーザー設定の保存ファイル
    └── learning_history.json     # (自動生成) AIの学習履歴の保存ファイル
    ```

## 🚀 使い方

1.  **アプリケーションの起動**:
    ターミナルで以下のコマンドを実行して、アプリケーションを起動します。
    ```bash
    python main.py
    ```

2.  **基本的なチャット**:
    画面下部の入力ボックスにメッセージを入力し、「送信」ボタンまたはEnterキーで送信します。

3.  **AIの指名**:
    メッセージ内に参加しているAIの名前（例：「凛さん」）を含めると、そのAIが応答します。

4.  **全員への質問**:
    参加者全員に意見を聞きたい場合は、`/ask_all`コマンドを使用します。
    ```
    /ask_all 今日の調子はどう？
    ```

5.  **コマンドの利用**:
    `/help`と入力すると、利用可能な全てのコマンドとその説明が表示されます。

## 🔧 設定とカスタマイズ

### ペルソナの追加・編集

`personas.json` ファイルをテキストエディタで開くことで、AIのキャラクターを自由に追加・編集できます。各ペルソナは、以下の詳細な設定項目を持っています。

**`personas.json` の構造例:**

```json
{
  "id": "ryuji",
  "name": "竜司",
  "age": 38,
  "gender": "男性",
  "occupation": "私立探偵",
  "personality": "ハードボイルド、観察眼が鋭い、情に厚い。",
  "background": "元刑事。警察組織のやり方に嫌気がさして独立した。過去の事件で大切な相棒を失っている。",
  "values": "真実、依頼人との約束、孤独とバーボン。",
  "quirks": "タバコの代わりにフリスクをよく食べる。「フッ」と鼻で笑う。",
  "goals": "かつての相棒を死に追いやった、未解決事件の真相を突き止めること。",
  "speaking_style": "独り言のような、少し芝居がかった口調。「フッ、面白い事件の匂いがするぜ」「俺に隠し事は通用しねぇ」"
}
```

### 学習履歴の確認

各ペルソナが会話を通じて何を学び、どう理解したかは、プロジェクトフォルダに自動生成される **`learning_history.json`** ファイルで確認できます。このファイルには、各ペルソナの「記憶の要約」が保存されています。

## 📜 ライセンス

このプロジェクトはMITライセンスの下で公開されています。
